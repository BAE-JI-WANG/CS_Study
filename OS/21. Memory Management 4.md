> 본 글은 이화여대 반효경 교수님의 [운영체제 강의(2014)](http://www.kocw.net/home/search/kemView.do?kemId=1046323) 내용에 대해 학습하고 정리한 내용입니다.


# 21. Memory Management 4

## 0. Segmentation

![](https://i.imgur.com/Xawhbor.png)

 앞서 페이지 테이블에서 봤던 것 처럼 segment 번호(논리적인 주소 위치)가 같아야 sharing이 가능하게 된다. 
 
위 그림을 보면 editor는 하나의 카피로 물리적인 주소에 저장된다. segment table을 보면 논리적인 주소 위치가 동일함을 알 수 있다. 또한 private segment인 data1,2는 서로 다른 물리적인 주소에 저장된다. 

## 1. Segmentation with Paging (=Paged Segment)

![](https://i.imgur.com/L9qanat.png)

Segment를 여러 페이지로 구성하는 기법이다. 이에 결국에는 물리적인 메모리에는 페이지가 올라가게 된다.  

segment 하나가 여러 개의 페이지로 구성되기 때문에, 먼저 segment에 대한 주소 변환이 진행된다. 

이에 먼저 segment table을 찾아야 한다. 

> 앞서 말한 것 처럼 물리적인 메모리에는 페이지 단위로 올라가기 때문에 hole(external fragmentation)이 발생하지 않게 된다. 

페이지 단위로 올라간다는 점에서 의미 단위로 일을하는 작업들은 어떻게 하나 싶을 수 있지만, 의미 단위로 해야하는 공유나 보안같은 업무는 segmentation 레벨에서 처리해준다. 

사실 실제로는 순수한 segmentation만을 사용하지는 않고 page table도 함께 사용하여 단점을 보완하여 사용한다. 

정리해보자면 기존의 original segmentation 처럼 segment-table entry가 segment의 base address를 가지고 있는 것이 아니라, segment를 구성하는 page table의 base address를 가지고 있다는 것이 중요한 차이다!

즉 두 단계를 거쳐야하는 것이다. 

먼저 segmentation의 주소 변환이 정상적으로 되었다고 가정했을 때, 기존의 segment offset인 d는 다시 페이지 번호를 나타내는`p`와 페이지 안에서 얼마나 떨어져있는지를 나타내는 offset `d'`로 분리된다. 

이를 가지고 주소 변환을 하면 프레임 번호인 f를 알 수 있고, 페이지의 offset인 `d'`를 가지고 물리적인 메모리 주소를 정할 수 있는 것이다. 

---

사실 이번 Memory Management 챕터의 경우 물리적인 메모리 관리에 대한 부분이었다. 

프로세스가 논리적인 주소를 가지고 있을 때, 요청에 의해 물리적인 메모리 주소로 변환하여 메모리 참조를 하도록 하는 것이 핵심이었다.

그렇다면 주소 변환 과정에서 운영 체제의 역할을 무엇이었을까?

주소변환에서 운영체제의 역할은 지금까지 없었다고 한다... 

이 무슨 반전인가...

지금껏 모두 하드웨어가 해주고 있었던 것이다!

왜 그런지 살펴보자. 프로세스 하나가 cpu를 잡고 실행하고 있으면서 주소 요청을 했을 때 주소변환이 이루어지게 된다. 이 때 메모리 참조를 해야하는데, 어떤 프로세스가 cpu를 가지고 있으면서 메모리 참조를 하는 것은 운영 체제의 도움을 받지 않는다고 한다.

주소 변환을 할 때 마다 매번 운영체제가 개입한다면 cpu가 프로세스에서 운영체제로 넘어가게 되고, 주소 변환을 완료했으니 다시 프로세스에게 cpu가 넘어오는 과정 자체가 말이 안된다고 한다!

주소변환 때 마다 운영 체제가 필요하다면 운영 체제와 프로세스 사이에서 cpu가 계속 왔다갔다 해야 하기에 이 역할은 하드웨어가 해주는 것이다. 그래서 주소변환은 하드웨어적으로 이루어지는 일이라는 것을 알고 있으면 될 것 같다!

운영체제도 하나의 프로그램이기에 이를 인지하고 있으면 이해에 도움될 것 같다.

운영체제가 끼어드는 경우는 I/O에 접근하는 경우였다. 프로세스가 직접 I/O를 할 수 없기에 운영 체제에 요청하곤 했었다. 

다음 챕터인 Virtual Memory에서는 운영 체제가 중요한 역할을 하게 된다! 






