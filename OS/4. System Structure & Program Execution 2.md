> 본 글은 이화여대 반효경 교수님의 [운영체제 강의(2014)](http://www.kocw.net/home/search/kemView.do?kemId=1046323) 내용에 대해 학습하고 정리한 내용입니다. 


# 4. System Structure & Program Execution 2

> I/O 는 OS(커널)를 통해서만 제어 가능하다

## 0. 동기식/비동기식 입출력 

> 1. 동기식 입출력

I/O 요청 후 입출력 작업이 완료되어야, 제어가 사용자 프로그램에 넘어간다. 

이를 두 가지 방법으로 구현해 볼 수 있다. 

- CPU를 빼앗지 않는 방법
	- I/O 작업이 끝날 때 까지 CPU를 점유하고 있기에 다른 일을 할 수 없다. 이에 처리되는 동안 CPU가 일을 못하기에 CPU가 낭비될 수 있다. 
	- 매 순간 하나의 I/O만 일어난다. 
- CPU를 빼앗는 방법
	- I/O가 완료될 때 까지 해당 프로그램의 CPU를 빼앗는다. 
	- 다른 프로그램으로 CPU가 가기 때문에 놀지 않고 작업할 수 있다.

> 2. 비동기식 입출력

I/O 요청 후 입출력 작업 끝나기를 기다리지 않고, 제어가 사용자 프로그램에 바로 넘어간다. 

두 경우 모두 I/O가 끝났음을 interrupt로 알려준다.

## 1. DMA(Direct Memory Access)

메모리에 접근할 수 있는 또 하나의 장치이다. 

I/O 장치에서 발생하는 규모가 작은 일들은 CPU에 인터럽트를 걸어 처리하는 것이 아니라 local buffer의 데이터를 DMA가 메모리에 복사하게 된다. 그 이후 어느정도 I/O가 끝나게 되면 CPU에 인터럽트를 걸어 I/O 작업이 완료되었음을 알려주게 된다. 

이 덕분에 CPU가 interrupt를 당하는 빈도가 줄어 CPU를 보다 더 효율적으로 사용할 수 있게 된다.

## 2. 저장장치 계층 구조 

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbd9gmS%2Fbtral7pqSpY%2FJyE1jpsoMkAjQm5TGrxbik%2Fimg.png)

- 휘발성
	- register, cache, 메인 메모리
- 비휘발성
	- magnetic disk, optical disk, magnetic tape

## 3. 프로그램의 실행

프로그램은 실행 파일 형태로 하드 디스크에 저장이 된다. 실행 파일을 실행하면 그제서야 메모리에 올라가서 프로세스가 된다. 그래서 실행이 가능해지는 것인데, 물리적인 메모리에 바로 올라가는 것이 아니라 한 단계를 거치게 된다. 바로 가상 메모리를 거치는 단계이다. 

프로그램을 실행하게 되면 0번지부터 시작하는 해당 프로그램의 메모리 주소 공간 (`stack`, `data`, `code`) 이 형성이 된다. 이러한 주소 공간은 각 프로그램마다 독자적으로 가지고 있다.

이제 이 가상 메모리를 물리적인 메모리에 올려서 프로그램이 실행된다. 이후 프로그램을 종료하게 되면 메모리에서 사라지게 된다.

그리고 가상 메모리에 있는 요소들을 모두 물리적인 메모리에 다 올리는 것은 아니고, 실행에 필요한 코드만 물리적인 메모리에 올려서 최대한 메모리 자원이 낭비되지 않도록 한다. 

> user mode : 사용자 프로그램의 주소 공간에서 CPU를 실행하는 순간
> kernel mode : 커널의 주소 공간에서 CPU가 실행되는 순간


프로그램은 계속 user mode와 kernel mode를 오가다가 종료되게 된다. 사용자 프로그램에서 코드가 실행되는 경우 user mode가 되고, 만약 I/O 입출력이 필요해서 커널에 요청하는 등 커널의 주소 공간에서 CPU가 실행되는 순간을 kerel mode라고 한다. 프로그램이 실행되다가 interrupt가 걸려서 OS가 호출되는 모드도 kernel 모드이다. 

앞서 봤던 `mode bit`이 이 모드들을 의미한다고 봐도 될 것 같다. 

## 4. 커널의 주소 공간 내용

- code
	- 시스템 콜, 인터럽트 처리 코드 
	- 자원 관리를 위한 코드
	- 편리한 서비스 제공을 위한 코드 
- data
	- 운영 체제가 사용하는 자료구조가 있다.
	- PCB(Process Control Block)
	- CPU, memory, disk
- stack
	- 프로세스의 커널 스택 
		- A라는 사용자 프로그램이 시스템 콜하면 프로세스 A의 커널 스택이 생긴다.
		- 프로그램마다 별도로 관리한다. 

## 5. 함수

- 사용자 정의 함수
	- 자신의 프로그램에서 정의한 함수
- 라이브러리 함수
	- 자신의 프로그램에서 정의하지 않고 가져다 쓴 함수
	- 자신의 프로그램의 실행 파일에 포함

이는 모두 특정 사용자 프로그램의 프로세스 주소 공간의 code 영역에 할당된다. 

- 커널 함수
	- 운영 체제 프로그램의 함수
	- 커널 함수의 호출 = 시스템 콜

이는 커널 주소 공간의 code에 들어간다.  


