> 본 글은 이화여대 반효경 교수님의 [운영체제 강의(2014)](http://www.kocw.net/home/search/kemView.do?kemId=1046323) 내용에 대해 학습하고 정리한 내용입니다.


# 24. File Systems 1

## 1. File and File System

- File
    - 관련 정보를 이름을 가지고 저장한다
    - 비휘발성의 보조기억장치(하드디스크)에 저장한다.
    - 운영체제에는 다양한 저장 장치를 file이라는 동일한 논리적 단위로 볼 수 있게 해준다. 
    - 파일에 대해서는 여러 연산이 가능하다
        - create
        - read/write
        - delete
        - reposition(lseek) 
            - 파일의 어느 위치를 읽고/쓰는지를 나타내는 포인터가 위치에 따라 달라짐
            - 다른 부분부터 읽고 싶을 때 이 포인터를 옮기게 되는데, 이 때 포인터를 이동하는 것을 reposition이라고 한다.
        - open/close
            - 연산을 하기 전 최우선적으로 open해야하고, 작업을 마치고 close해야한다. 
            - open은 파일의 metadata를 메모리에 올려두는 작업이다. 
- File attribute(= Metadata)
    - 파일 자체의 내용이 아니라 파일을 관리하기 위한 각종 정보들
        - 파일 이름, 유형, 저장된 위치, 파일 사이즈
        - 접근 권한(읽기/쓰기/실행), 시간(생성/변경/사용), 소유자 등
- File system
    - 운영 체제에서 파일을 관리하는 부분
    - 파일 및 파일의 메타데이터, 디렉토리 정보 등을 관리
    - 파일의 저장 방법을 결정
    - 파일 보호

## 2. Directory and Logical Disk

- Directory
    - 파일 메타데이터 중 일부를 보관하고 있는 일종의 특별한 파일이다
    - 디렉토리의 내용은 하위 파일들의 메타데이터가 된다
        - 즉 여러 파일의 정보들을 가지고 있는 집합같은 개념
    - 디렉토리에 대해서도 여러 연산이 가능하다
        - search, create, delete file
        - list, rename a file, traverse file system
- Partition(= Logical Disk)
    - 운영체제가 보는 디스크이다
    - C, D드라이브를 나누는 것과 같음 
    - 하나의 물리적인 디스크 안에 여러 파티션을 두는게 일반적이다
    - 여러 개의 물리적인 디스크를 하나의 파티션으로 구성하기도 한다
    - 물리적인 디스크를 파티션으로 구성한 뒤, 각각 파티션에 `file system`을 깔거나, `swapping` 용도로 사용할 수 있다.

## 3. open()

파일의 메타데이터를 메모리에 올리는 행위이다. 

만약 `open(a/b/c)` 였다면 디스크로부터 파일 c의 메타데이터를 메모리로 가지고 오는 것이다. 

이를 위해 directory path를 검색해야한다. 

![](https://i.imgur.com/KZpPB5u.png)


- 루트 디렉토리의 메타데이터는 논리적인 메모리가 미리 알고 있다. (이미 존재한다)
- 이를 열어서 root의 content를 받아와서, 그 내용인 파일들의 메타데이터를 찾는다. 
- a라는 파일의 메타데이터를 찾아서 메모리에 올린다.(a열기)
- a의 메타 데이터에는 a의 내용, 위치가 있을 것이다. 
- a도 디렉토리이기에 a의 내용에는 b라는 메타데이터가 있다.
- 즉 b라는 파일의 메타데이터를 찾아서 메모리에 올리면 open이 끝나게 된다. 
- open한 파일들에 대한 위치를 가리키는 포인터의 위치는 file descriptor를 통해 얻을 수 있다. 
- 이제 b의 내용을 얻게 되는데, 바로 사용자 메모리 영역에 보내는 것이 아니라, 커널 메모리 영역 일부에 공간을 만들어서 저장해둔다. 
- 그 다음, 내용을 카피해서 사용자 메모리 영역에 전달해준다. 
- 이미 운영체제가 읽어온 데이터가 있기 때문에 다른 프로세스가 같은 파일을 요청해도 메모리까지 갈 필요가 없다. 기존에 저장해둔 데이터를 카피해서 다른 프로세스에 전달해주면 된다. 이를 `buffer caching`이라고 한다


## 4. File Protection

각 파일에 대해 `누구`에게 어떤 유형의 `접근`(read/write/execution)을 허락할 것인가에 대한 내용이다. 

![](https://i.imgur.com/xmc7Cn3.png)

- Access Control Matrix    
    - access control list: 파일별로 누구에게 어떤 접근 권한이 있는지 표시
    - capability: 사용자별로 자신이 접근 권한을 가진 파일 및 해당 권한 표시
- Group
    - 전체 사용자를 owner, group, public의 세 그룹으로 구분
    - 각 파일에 대해 세 그룹의 접근 권한(read/write/execution)을 3비트씩으로 표시
    - 예를 들어서 owner, group, other 순으로 
        - rwx|r--|r-- 와 같이 표기해볼 수 있다. 
- Password 
    - 파일마다 password를 두는 방법이다. 디렉토리 파일에 두는 방법도 가능하다!
    - 모든 접근 권한에 대해 하나의 password를 두는 것이다.
    - password는 매번 기억해야하고, 관리하기 어렵다는 단점이 있다.

일반적으로는 Group의 방법을 사용한다!

## 5. File system의 Mounting

물리적인 디스크를 파티셔닝을 통해 논리적인 디스크로 나눌 수 있다. 각각의 논리 디스크는 각각의 파일 시스템을 사용한다.

이 때 특정 운영체제에 대해 파일 시스템 하나가 접근 가능한데, 만약 다른 파티션의 파일 시스템이 접근해야할 때는 어떻게 할까?

이 때를 위해 mounting이라는 연산이 있는 것이다. 

![](https://i.imgur.com/1KDDMFO.png)

mounting이란, root file system의 이름 중 하나인 usr에 또 다른 파티션에 있는 root file system을 연결하는 것이다. 

이 덕분에 다른 파일시스템에도 접근할 수 있는 것이다.

## 6. Access Methods

시스템이 제공하는 파일 정보의 접근 방식을 말한다. 

- 순차 접근
    - 카세트 테이프처럼 순서대로 들어야 하는 것과 같다
    - 읽거나 쓰면 offset은 자동적으로 증가한다
- 직접 접근
    - LP 레코드 판 처럼 원하는 부분에 접근할 수 있다.
    - 파일을 구성하는 레코드를 임의의 순서로 접근할 수 있다.
